# Kick Speedmeter (MediaPipe Pose, Web)

https://fuji3to4.github.io/kick-speedmeter/

サッカーのキック速度を MediaPipe Pose で計測するシンプルな Web アプリです。
- ライブ（カメラ）計測
- 動画ファイルからの計測と速度カーブ可視化
- お手本動画と自分の動画の骨格検出・速度/膝角の比較（相関）

> 注意: 物理単位 m/s の算出には、ピクセル→メートル換算（校正）が必要です。初期値では px/s のみ正確で、m/s は校正値が 0 だと無効化されます。

## 使い方

1. 依存ライブラリのインストール（初回のみ）

```powershell
npm install
```

2. 開発サーバ起動

```powershell
npm run dev
```

3. ブラウザで開く: http://localhost:5173/

### ライブ計測
- 「カメラ開始」を押すと骨格と足先がトラッキングされ、速度(px/s, m/s)が表示されます。
- 「フット」で左右の足を切り替え可能。
- 「メートル/ピクセル(m/px)」に校正値を入れると m/s 表示が有効になります。

### 動画から計測
- 動画ファイルを選択して再生すると、速度がフレームごとに計算され、最大速度や発生時刻、速度グラフが表示されます。

### 動画比較
- お手本動画と自分の動画を選択し、それぞれ再生終了後に速度カーブ(px/s)と膝角(°)の系列をリサンプル・重ね描きします。
- 速度カーブ・膝角カーブのピアソン相関係数を表示します（1に近いほど似ています）。

## 校正（m/px の求め方）
- 簡易法: 画面幅に相当する現実世界の幅W[m]がわかっていれば、m/px = W / videoWidth(px)
  - 例: 画面の横に 2m の白線が映っていて、動画幅が 1920px → m/px ≈ 2/1920 ≈ 0.00104
- 厳密法: ArUco マーカーや既知寸法の物体を用いたカメラキャリブレーション（将来拡張）。

## 参考: 足先ランドマーク
MediaPipe Pose では以下を利用しています。
- 左足: ankle=27, foot_index=31
- 右足: ankle=28, foot_index=32

## 制限事項 / TODO
- m/s は校正必須。現在はユーザ入力の m/px のみ対応。
- 動画比較は単純な時間正規化（等間隔リサンプル）+ ピアソン相関。将来、DTW 等の高度比較を検討。
- FPS 低下時のスムージングは EMA のみ。必要に応じてフィルタや外れ値除去を追加。
- モバイル Safari の場合、カメラ起動に追加の許可や操作が必要な場合があります。

## ライセンス
- MediaPipe Tasks Vision のモデルと WASM は Google の提供する配布元から直接読み込みます。
- このリポジトリのコードは MIT ライセンス相当で利用可能です（適宜変更してください）。